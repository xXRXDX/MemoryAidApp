<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Tasks</title><link rel="stylesheet" href="styles.css"/>
    <link rel="stylesheet" href="task.css"/>
<link rel="stylesheet" href="style_mod.css">
</head>
<body>

<main class="container">
    <div class="phone" role="application" aria-label="Tasks">
        <div class="safe">
            <div class="title">Tasks</div></div></div><div><a href="tasks.html" class="small">Back</a></div></div>
            <div class="card"><div id="task-list"></div>
                <div class="my-tasks-header">
                    <div class="kv">My Tasks</div>
                </div>

                <!-- Replace task list with quest category navigation buttons -->
                <div id="quest-nav" class="quest-nav-container">
                    <a href="daily-quests.html" class="quest-nav-btn daily-quests-nav">
                        <span>Daily Quests</span>
                    </a>
                    <a href="main-missions.html" class="quest-nav-btn main-missions-nav">
                        <span>Main Quests</span>
                    </a>
                    <a href="side-quests.html" class="quest-nav-btn side-quests-nav">
                        <span>Side Quests</span>
                    </a>
                </div>

                <!-- Add New Task button at bottom -->
                <button id="add-task-btn" class="button add-task-bottom">+ Add New Task</button>
            </div>
        </div>
    </div>
    <nav class="bottom-nav" role="navigation" aria-label="Main">
        <a href="home.html">Home</a>
        <a href="tasks.html">Tasks</a>
        <a href="streak-overview.html">Streak</a>
        <a href="avatar.html">Avatar</a>
        <a href="community.html">Community</a>
    </nav>

    <script>
        (function(){
            const listEl=document.getElementById('task-list');
            const addBtn=document.getElementById('add-task-btn');

            if (addBtn) {
                addBtn.addEventListener('click', () => {
                    window.location.href = 'add-task.html';
                });
            }

            function load(){
                const tasks=JSON.parse(localStorage.getItem('stm_tasks')||'[]');

                const dailyQuests = tasks.filter(t => t.priority === 'medium');
                const mainMissions = tasks.filter(t => t.priority === 'high');
                const sideQuests = tasks.filter(t => t.priority === 'low');

                listEl.innerHTML = '';

                // Helper function to render quest category
                function renderCategory(title, questList, categoryClass) {
                    if (questList.length === 0) return;

                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = `quest-category ${categoryClass}`;

                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'quest-category-title';
                    titleDiv.textContent = title;
                    categoryDiv.appendChild(titleDiv);

                    const questListDiv = document.createElement('div');
                    questListDiv.className = 'quest-list';

                    questList.forEach(t => {
                        const questItem = document.createElement('div');
                        questItem.className = `quest-item ${t.done ? 'completed' : ''}`;
                        questItem.innerHTML = `
          <label style="display:flex;align-items:center;gap:8px;">
            <input type="checkbox" ${t.done ? 'checked' : ''} data-id="${t.id}"/>
            <div style="font-weight:${t.done ? 400 : 700}">${t.text}</div>
          </label>
          <button class="ghost" data-del="${t.id}">Delete</button>
        `;
                        questListDiv.appendChild(questItem);
                    });

                    categoryDiv.appendChild(questListDiv);
                    listEl.appendChild(categoryDiv);
                }

                renderCategory('Daily Quests', dailyQuests, 'daily-quests');
                renderCategory('Main Missions', mainMissions, 'main-missions');
                renderCategory('Side Quests', sideQuests, 'side-quests');
            }

            document.addEventListener('click', function(e){
                const cb=e.target.closest('input[type="checkbox"]');
                if(cb && cb.dataset.id){
                    const id=Number(cb.dataset.id);
                    const tasks=JSON.parse(localStorage.getItem('stm_tasks')||'[]');
                    tasks.forEach(t=>{
                        if(t.id===id) t.done=cb.checked;
                    });
                    localStorage.setItem('stm_tasks', JSON.stringify(tasks));
                    load();
                }

                const del=e.target.closest('button[data-del]');
                if(del){
                    const id=Number(del.getAttribute('data-del'));
                    let tasks=JSON.parse(localStorage.getItem('stm_tasks')||'[]');
                    tasks=tasks.filter(t=>t.id!==id);
                    localStorage.setItem('stm_tasks', JSON.stringify(tasks));
                    load();
                }
            });

            load();
        })();
    </script>
</main>
<script src="js/tasks_ui.js"></script>
</body></html>

<script>
function startMissionFromTask(name,time){
    localStorage.setItem('stm_active_task', JSON.stringify({name:name,time:time}));
    window.location.href="focus-timer.html";
}
document.querySelectorAll('.task-item').forEach(el=>{
    el.onclick=()=>{
        const name=el.dataset.name;
        const time=el.dataset.time||"";
        if(confirm("Start this mission?")) startMissionFromTask(name,time);
    };
});
</script>
